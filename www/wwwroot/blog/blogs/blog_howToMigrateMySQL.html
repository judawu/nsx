<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MySQL 数据库备份与迁移指南</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    pre code {
      background-color: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      display: block;
      overflow-x: auto;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
  <div class="container mx-auto max-w-4xl p-6 bg-white shadow-lg rounded-lg mt-8">
    <h1 class="text-4xl font-bold text-center mb-6">MySQL 数据库备份与迁移指南</h1>


    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">前言</h2>
      <p class="mb-4">MySQL 是广泛使用的关系型数据库管理系统。本文整理了 MySQL 数据库的备份、迁移、配置文件位置、Linux 相关操作（如拷贝和权限更改）以及在未知账号密码情况下的物理迁移方法。内容适用于 Linux 环境，特别是 VMware 虚拟机场景，旨在帮助管理员高效管理数据库。</p>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">1. MySQL 数据库备份</h2>
      <h3 class="text-xl font-medium mb-2">1.1 使用 mysqldump 工具</h3>
      <p class="mb-2"><code>mysqldump</code> 是 MySQL 官方提供的逻辑备份工具，适合导出数据库结构和数据为 SQL 文件。</p>
      <p class="mb-2"><strong>命令：</strong></p>
      <pre><code>bash
mysqldump -u [用户名] -p [数据库名] > 备份文件名.sql
      </code></pre>
      <p class="mb-2"><strong>示例：</strong></p>
      <pre><code>bash
mysqldump -u root -p mydatabase > /path/to/backup.sql
      </code></pre>
      <p class="mb-2">备份所有数据库：<code>mysqldump -u root -p --all-databases > all_databases.sql</code></p>
      <p class="mb-2"><strong>常用选项：</strong></p>
      <ul class="list-disc ml-6 mb-4">
        <li><code>--databases db1 db2</code>：备份多个指定数据库。</li>
        <li><code>--no-data</code>：仅备份结构。</li>
        <li><code>--routines</code>：包含存储过程和函数。</li>
      </ul>

      <h3 class="text-xl font-medium mb-2">1.2 物理备份</h3>
      <p class="mb-2">直接拷贝数据目录（通常为 <code>/var/lib/mysql</code>），适合大数据库。</p>
      <p class="mb-2"><strong>步骤：</strong></p>
      <ol class="list-decimal ml-6 mb-4">
        <li>停止 MySQL：<code>systemctl stop mysql</code></li>
        <li>拷贝目录：<code>cp -r /var/lib/mysql /path/to/backup</code></li>
        <li>启动 MySQL：<code>systemctl start mysql</code></li>
      </ol>
      <p class="mb-2"><strong>注意</strong>：必须停止服务以确保数据一致性。</p>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">2. MySQL 数据库还原</h2>
      <h3 class="text-xl font-medium mb-2">2.1 使用 mysql 命令</h3>
      <p class="mb-2">从 SQL 文件还原数据库。</p>
      <pre><code>bash
mysql -u [用户名] -p [数据库名] < 备份文件名.sql
      </code></pre>
      <p class="mb-2"><strong>示例：</strong> <code>mysql -u root -p mydatabase < /path/to/backup.sql</code></p>
      <p class="mb-2">先创建数据库（若不存在）：<code>CREATE DATABASE mydatabase;</code></p>

      <h3 class="text-xl font-medium mb-2">2.2 物理还原</h3>
      <p class="mb-2"><strong>步骤：</strong></p>
      <ol class="list-decimal ml-6 mb-4">
        <li>停止 MySQL：<code>systemctl stop mysql</code></li>
        <li>替换数据目录：<code>cp -r /path/to/backup /var/lib/mysql</code></li>
        <li>修复权限：<code>chown -R mysql:mysql /var/lib/mysql</code></li>
        <li>启动 MySQL：<code>systemctl start mysql</code></li>
      </ol>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">3. MySQL 配置文件和数据目录</h2>
      <h3 class="text-xl font-medium mb-2">3.1 配置文件位置</h3>
      <p class="mb-2">Linux 中 MySQL 配置文件通常为 <code>my.cnf</code> 或 <code>my.cnf.d/</code> 目录。</p>
      <p class="mb-2"><strong>常见位置：</strong></p>
      <ul class="list-disc ml-6 mb-4">
        <li><code>/etc/my.cnf</code>（CentOS/RHEL）</li>
        <li><code>/etc/mysql/my.cnf</code>（Ubuntu/Debian）</li>
        <li><code>/etc/mysql/mysql.conf.d/</code>（模块化配置）</li>
      </ul>
      <p class="mb-2"><strong>查找方法：</strong></p>
      <pre><code>bash
find /etc -name my.cnf 2>/dev/null
mysql --help | grep "Default options"
      </code></pre>

      <h3 class="text-xl font-medium mb-2">3.2 数据目录</h3>
      <p class="mb-2">默认数据目录：<code>/var/lib/mysql</code></p>
      <p class="mb-2"><strong>确认方法：</strong></p>
      <pre><code>sql
SHOW VARIABLES LIKE 'datadir';
      </code></pre>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">4. Linux 拷贝文件和权限管理</h2>
      <h3 class="text-xl font-medium mb-2">4.1 拷贝文件（cp 命令）</h3>
      <p class="mb-2"><strong>基本命令：</strong> <code>cp [选项] 源文件 目标文件</code></p>
      <p class="mb-2"><strong>示例：</strong></p>
      <pre><code>bash
cp -r /var/lib/mysql /backup/  # 拷贝目录
cp /etc/my.cnf /backup/my.cnf  # 拷贝文件
      </code></pre>
      <p class="mb-2"><strong>常用选项：</strong></p>
      <ul class="list-disc ml-6 mb-4">
        <li><code>-r</code>：递归拷贝目录</li>
        <li><code>-p</code>：保留文件属性</li>
        <li><code>-v</code>：显示拷贝过程</li>
      </ul>

      <h3 class="text-xl font-medium mb-2">4.2 更改权限（chmod 命令）</h3>
      <p class="mb-2"><strong>基本命令：</strong> <code>chmod -R 权限模式 文件夹</code></p>
      <p class="mb-2"><strong>示例：</strong></p>
      <pre><code>bash
chmod -R 750 /var/lib/mysql  # 设置 MySQL 数据目录权限
chown -R mysql:mysql /var/lib/mysql  # 更改拥有者
      </code></pre>
      <p class="mb-2"><strong>数字权限：</strong> 755（读写执行+读执行），700（仅拥有者有权限）。</p>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">5. 未知密码下的物理迁移</h2>
      <p class="mb-2">即使不知道 MySQL 账号密码，物理迁移（拷贝数据目录）依然可行，因为用户和密码数据存储在 <code>mysql.user</code> 表中，随数据目录迁移。</p>
      <h3 class="text-xl font-medium mb-2">5.1 迁移步骤</h3>
      <ol class="list-decimal ml-6 mb-4">
        <li><strong>检查版本</strong>：
          <pre><code>bash
mysql --version
          </code></pre>
        </li>
        <li><strong>停止源 MySQL</strong>：
          <pre><code>bash
sudo systemctl stop mysql
          </code></pre>
        </li>
        <li><strong>拷贝数据目录</strong>：
          <pre><code>bash
sudo rsync -av /var/lib/mysql/ /backup/mysql/
scp -r /backup/mysql user@target_vm:/var/lib/mysql
          </code></pre>
        </li>
        <li><strong>配置目标服务器</strong>：
          <pre><code>bash
sudo systemctl stop mysql
sudo mv /var/lib/mysql /var/lib/mysql.bak
sudo mv /backup/mysql /var/lib/mysql
sudo chown -R mysql:mysql /var/lib/mysql
sudo chmod -R 750 /var/lib/mysql
          </code></pre>
        </li>
        <li><strong>拷贝配置文件</strong>：
          <pre><code>bash
scp /etc/mysql/my.cnf user@target_vm:/etc/mysql/my.cnf
          </code></pre>
        </li>
        <li><strong>清理日志文件</strong>：
          <pre><code>bash
sudo rm /var/lib/mysql/ib_logfile*
          </code></pre>
        </li>
        <li><strong>启动目标 MySQL</strong>：
          <pre><code>bash
sudo systemctl start mysql
          </code></pre>
        </li>
        <li><strong>重置 root 密码</strong>：
          <pre><code>bash
sudo systemctl stop mysql
sudo mysqld_safe --skip-grant-tables &
mysql -u root
          </code></pre>
          <pre><code>sql
USE mysql;
ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';
FLUSH PRIVILEGES;
          </code></pre>
          <pre><code>bash
sudo pkill mysqld
sudo systemctl start mysql
          </code></pre>
        </li>
        <li><strong>验证迁移</strong>：
          <pre><code>sql
SHOW DATABASES;
SELECT * FROM your_table LIMIT 10;
mysqlcheck -A --all-databases -u root -p
          </code></pre>
        </li>
      </ol>

      <h3 class="text-xl font-medium mb-2">5.2 VMware 虚拟机注意事项</h3>
      <ul class="list-disc ml-6 mb-4">
        <li>虚拟机目录：<code>/home/user/vmware/VM_Name</code></li>
        <li>创建快照：<code>VMware -> VM -> Snapshot -> Take Snapshot</code></li>
        <li>确认网络：<code>ping target_vm_ip</code></li>
      </ul>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">6. 注意事项</h2>
      <ul class="list-disc ml-6 mb-4">
        <li><strong>版本兼容性</strong>：确保源和目标 MySQL 版本一致或目标版本更高。</li>
        <li><strong>数据一致性</strong>：迁移前停止 MySQL，避免文件损坏。</li>
        <li><strong>SELinux/AppArmor</strong>：
          <pre><code>bash
sudo setenforce 0
sudo aa-complain /usr/sbin/mysqld
sudo restorecon -R /var/lib/mysql
          </code></pre>
        </li>
        <li><strong>错误排查</strong>：检查日志 <code>/var/log/mysql/error.log</code>。</li>
      </ul>
    </section>

    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">7. 总结</h2>
      <p class="mb-4">本文提供了 MySQL 数据库备份与迁移的完整指南，涵盖逻辑备份（<code>mysqldump</code>）、物理迁移、配置文件管理、Linux 命令以及未知密码场景的解决方案。物理迁移适合快速迁移大数据库，尤其在 VMware 虚拟机环境中，结合快照和权限管理可确保安全操作。希望本文能帮助您高效完成数据库管理任务！</p>
    </section>

    <footer class="text-center text-gray-600 mt-8">
    
    
    </footer>
  </div>
</body>
</html>